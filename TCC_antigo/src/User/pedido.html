<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" a href="../css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <title>area de pedido online</title>
</head>

<body class="backgrond-black">
  <header>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg fixed-top bg-black navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand me-auto" href="index.html">
                <img src="../img/WhatsApp Image 2024-10-09 at 22.04.01.png" alt="Logo da Bella Massa"
                    width="100" height="100">
            </a>
            <div class="offcanvas offcanvas-end bg-dark text-white" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">BELLA MASSA</h5>
                    <button type="button" class="btn-close btn-close-white btn-primary btn-sm"
                        data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-center flex-grow-1 pe-3 text-white">
                        <li class="nav-item">
                            <a class="nav-link mx-lg-2 active" aria-current="page" href="#">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link mx-lg-2" href="#">Sobre nós</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link mx-lg-2" href="#">Promoções</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link mx-lg-2" href="#">Cardápio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link mx-lg-2" href="#">Contato</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Botões do Navbar -->
            <div class="button-navbar ms-auto">
                <button type="button" class="login-button btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal">
                    <img src="../img/do-utilizador (3).png" height="30" width="30"> Conta
                </button>
                <button class="login-button"><a href=""></a>
                    <img src="../img/carrinho-de-compras.png" height="30" width="30"> Pedidos
                </button>
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Modal (movido para fora do navbar) -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">LOGIN</h1>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="container p-5">
                        <form class="form-vermelho">
                            <div class="mb-3">
                                <div class="title">
                                    <h1>Acesse sua conta</h1>
                                </div>
                                <label for="email" class="form-label">Digite seu email:</label>
                                <input type="email" name="email_usuario" placeholder="Digite seu email" id="email"
                                    class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="">Digite sua senha:</label>
                                <input type="password" name="senha_usuario" placeholder="Digite sua senha"
                                    id="senha" class="form-control" required>
                            </div>
                            <div class="link-recuperar-senha">
                                <a href="#">esqueci minha senha</a>
                            </div>
                            <div class="center-button">
                                <button type="submit" class="button-black btn-submit">Conectar</button>
                            </div>
                            <div class="form-container">
                                <div class="divider">
                                    <span>ou</span>
                                </div>
                                <p>Ainda não tem cadastro?</p>
                                <div class="center-button">
                                    <button type="submit" class="button-black btn-submit"><a
                                            href="../src/formscadastro.html">Quero me
                                            cadastrar</a></button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <!--  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
 -->
                </div>
            </div>
        </div>
    </div>
</header>

<main class="container my-5">
  <h2 class="mb-4">Resumo do Pedido</h2>
  <div id="pedido-pizzas" class="mb-4"></div>
  <div id="pedido-bebidas" class="mb-4"></div>
  <div class="mb-3">
    <label for="observacao-pedido" class="form-label">Observações do pedido:</label>
    <textarea id="observacao-pedido" class="form-control" rows="3" placeholder="Ex: sem cebola, entregar no portão..."></textarea>
  </div>
  <div class="mb-3 text-end">
    <button id="btn-finalizar-pedido" class="btn btn-success">Finalizar Pedido</button>
  </div>
</main>

   <!--   FOOTER   -->
   <footer class="footer-conteiner">
    <div class="container text-center">
      <div class="row">
        <div class="col">
          <img class="logo-grande" src="../img/WhatsApp Image 2024-10-09 at 22.04.01.png" alt="">
        </div>
        <div class="col">
          <h5>Endereço</h5>
          <p>Av João Gonçalves dos Reis, 350, Medeiros(Esquina com a Av Francisco Nobre)</p>
          <p>São Paulo-SP</p>
        </div>
        <div class="col">
          <h5>Telefone</h5>
          <p>(11)9002-0922</p>
          <p>(11)9002-0922</p>
        </div>
        <div class="col">
          <h5>Horário de funcionamento</h5>
          <h6>Terça a Quinta</h6>
          <p> Das 17:00 ás 00:00</p>
          <h6>Sexta á Sábado</h6>
          <p> Das 17:00 ás 01:00</p>
        </div>
      </div>

      <!-- Redes Sociais abaixo das colunas -->
      <div class="row">
        <div class="col redes-sociais">
          <a href="#" class="midia"><img src="../img/whatsapp.png" height="30" width="30"></a>
          <a href="#" class="midia"><img src="../img/instagram.png" height="30" width="30"></a>
          <a href="#" class="midia"><img src="../img/tik-tok (1).png" height="30" width="30"></a>
        </div>
      </div>
    </div>
  </footer>


  <!-- BOOTSTARP JS -->
  <script src="JAVASCRIPT/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    const pizzas = carrinho.filter(item => item.tabela !== 'bebida');
    const bebidas = carrinho.filter(item => item.tabela === 'bebida');

    // Renderizar pizzas
    const pizzasDiv = document.getElementById('pedido-pizzas');
    if (pizzas.length > 0) {
      pizzasDiv.innerHTML = '<h4>Pizzas</h4>' + pizzas.map(pizza => `
        <div class="card mb-2">
          <div class="card-body d-flex align-items-center">
            <img src="${pizza.imagem || ''}" alt="${pizza.sabor}" style="width:60px;height:60px;object-fit:cover;margin-right:15px;">
            <div>
              <strong>${pizza.sabor}</strong><br>
              <span>${pizza.tamanho || ''}</span><br>
              <span>Qtd: ${pizza.quantidade || 1}</span><br>
              <span>R$ ${pizza.preco_sabor ? pizza.preco_sabor.toFixed(2) : ''}</span>
            </div>
          </div>
        </div>
      `).join('');
    } else {
      pizzasDiv.innerHTML = '<p>Nenhuma pizza no pedido.</p>';
    }

    // Renderizar bebidas
    const bebidasDiv = document.getElementById('pedido-bebidas');
    if (bebidas.length > 0) {
      bebidasDiv.innerHTML = '<h4>Bebidas</h4>' + bebidas.map(bebida => `
        <div class="card mb-2">
          <div class="card-body d-flex align-items-center">
            <div>
              <strong>${bebida.nome || ''}</strong><br>
              <span>${bebida.tamanho || ''}</span><br>
              <span>Qtd: ${bebida.quantidade || 1}</span><br>
              <span>R$ ${bebida.preco ? bebida.preco.toFixed(2) : ''}</span>
            </div>
          </div>
        </div>
      `).join('');
    } else {
      bebidasDiv.innerHTML = '';
    }

    // Finalizar pedido
    document.getElementById('btn-finalizar-pedido').addEventListener('click', async function() {
      const observacoes = document.getElementById('observacao-pedido').value;
      // Pegue o id_cliente, id_endereco e token do localStorage ou sessão do usuário
      const id_cliente = localStorage.getItem('id_cliente') || 1; // mock para teste
      const id_endereco = localStorage.getItem('id_endereco') || 1; // mock para teste
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Você precisa estar logado para finalizar o pedido.');
        return;
      }
      // Calcular total
      let total = 0;
      pizzas.forEach(p => { total += (p.preco_sabor || 0) * (p.quantidade || 1); });
      bebidas.forEach(b => { total += (b.preco || 0) * (b.quantidade || 1); });
      // Montar payload
      const payload = {
        id_cliente: Number(id_cliente),
        total,
        metodo_pagamento: 'pendente', // ou 'pix', 'cartao', etc
        tipo_entrega: 'delivery', // ou 'retirada', etc
        id_endereco: Number(id_endereco),
        observacoes,
        pizzas: pizzas.map(p => ({
          sabor: p.sabor,
          preco_sabor: p.preco_sabor,
          tipo_borda: p.tipo_borda,
          preco_borda: p.preco_borda,
          tamanho: p.tamanho,
          observacao: p.observacao,
          quantidade: p.quantidade
        })),
        bebidas: bebidas.map(b => ({
          nome: b.nome,
          tamanho: b.tamanho,
          preco: b.preco,
          quantidade: b.quantidade
        }))
      };
      try {
        const res = await fetch('http://localhost:3000/api/orders/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('Erro ao finalizar pedido');
        const data = await res.json();
        alert('Pedido realizado com sucesso! Aguarde o pagamento.');
        // Limpar carrinho
        localStorage.removeItem('carrinho');
        // Aqui você pode redirecionar para uma tela de status do pedido
      } catch (err) {
        alert('Erro ao finalizar pedido.');
      }
    });

    // Exemplo de função para atualizar status do pedido após pagamento
    // Chame esta função quando o gateway de pagamento confirmar
    window.atualizarStatusPedido = async function(id_pedido, novoStatus) {
      const token = localStorage.getItem('token');
      if (!token) return;
      await fetch('http://localhost:3000/api/orders/status', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ id_pedido, status: novoStatus })
      });
    }
  });
  </script>
</body>

</html>