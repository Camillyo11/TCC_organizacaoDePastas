<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Página ADM - Cadastro de Produtos</title>
  <link rel="stylesheet" href="../assets/css/styleADM.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="backgrond-black">
  <header class="header-adm">
    <nav class="nav-adm navbar navbar-lg bg-body-tertiary-dark navbar-dark">
      <div class="container-fluid d-flex align-items-center">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Cadastros</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Últimos pedidos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Pedidos entregues</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#">Edição de produtos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Avaliações</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="container mt-5">
    <h2 class="text-center mb-4 text-white">Cadastro de Novos Produtos</h2>
    
    <!-- Abas para diferentes tipos de produtos -->
    <ul class="nav nav-tabs justify-content-center mb-4" id="adminTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="nova-pizza-tab" data-bs-toggle="tab" data-bs-target="#nova-pizza" type="button">Nova Pizza</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="nova-bebida-tab" data-bs-toggle="tab" data-bs-target="#nova-bebida" type="button">Nova Bebida</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="nova-borda-tab" data-bs-toggle="tab" data-bs-target="#nova-borda" type="button">Nova Borda</button>
      </li>
    </ul>
  
    <!-- Conteúdo das abas -->
    <div class="tab-content p-3 border border-top-0 rounded-bottom bg-light" id="adminTabsContent">
      <!-- Formulário para Nova Pizza -->
      <div class="tab-pane fade show active" id="nova-pizza" role="tabpanel">
        <form id="form-nova-pizza" class="row g-3">
          <div class="col-md-6">
            <label for="pizza-nome" class="form-label">Nome da Pizza</label>
            <input type="text" class="form-control" id="pizza-nome" required>
          </div>
          <div class="col-md-6">
            <label for="pizza-categoria" class="form-label">Categoria</label>
            <select class="form-select" id="pizza-categoria" required>
              <option value="salgada">Salgada</option>
              <option value="doce">Doce</option>
            </select>
          </div>
          <div class="col-12">
            <label for="pizza-descricao" class="form-label">Descrição</label>
            <textarea class="form-control" id="pizza-descricao" rows="2" required></textarea>
          </div>
          <div class="col-md-4">
            <label for="pizza-preco" class="form-label">Preço (R$)</label>
            <input type="number" step="0.01" class="form-control" id="pizza-preco" required>
          </div>
          <div class="col-md-8">
            <label for="pizza-imagem" class="form-label">Imagem</label>
            <input type="file" class="form-control" id="pizza-imagem" accept="image/*">
            <small class="text-muted">Tamanho recomendado: 500x500px</small>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Cadastrar Pizza</button>
          </div>
        </form>
      </div>
  
      <!-- Formulário para Nova Bebida -->
      <div class="tab-pane fade" id="nova-bebida" role="tabpanel">
        <form id="form-nova-bebida" class="row g-3">
          <div class="col-md-6">
            <label for="bebida-nome" class="form-label">Nome da Bebida</label>
            <input type="text" class="form-control" id="bebida-nome" required>
          </div>
          <div class="col-md-6">
            <label for="bebida-tamanho" class="form-label">Tamanho/Volume</label>
            <input type="text" class="form-control" id="bebida-tamanho" placeholder="Ex: 1L, 350ml, Lata" required>
          </div>
          <div class="col-md-4">
            <label for="bebida-preco" class="form-label">Preço (R$)</label>
            <input type="number" step="0.01" class="form-control" id="bebida-preco" required>
          </div>
          <div class="col-md-8">
            <label for="bebida-imagem" class="form-label">Imagem</label>
            <input type="file" class="form-control" id="bebida-imagem" accept="image/*">
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Cadastrar Bebida</button>
          </div>
        </form>
      </div>
  
      <!-- Formulário para Nova Borda -->
      <div class="tab-pane fade" id="nova-borda" role="tabpanel">
        <form id="form-nova-borda" class="row g-3">
          <div class="col-md-6">
            <label for="borda-nome" class="form-label">Nome da Borda</label>
            <input type="text" class="form-control" id="borda-nome" required>
          </div>
          <div class="col-md-6">
            <label for="borda-preco" class="form-label">Preço Adicional (R$)</label>
            <input type="number" step="0.01" class="form-control" id="borda-preco" required>
          </div>
          <div class="col-12">
            <label for="borda-descricao" class="form-label">Descrição</label>
            <textarea class="form-control" id="borda-descricao" rows="2"></textarea>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Cadastrar Borda</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Modal de Confirmação -->
  <div class="modal fade" id="confirmacaoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Produto Cadastrado!</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmacaoMensagem">O produto foi cadastrado com sucesso!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          <button type="button" class="btn btn-primary" id="btn-adicionar-outro">Adicionar outro</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializa os formulários
      initForms();
      
      // Inicializa os offcanvas (menu lateral)
      const offcanvasTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="offcanvas"]'));
      offcanvasTriggerList.map(function (offcanvasTriggerEl) {
        new bootstrap.Offcanvas(offcanvasTriggerEl);
      });
    });

    function initForms() {
      // Formulário de Pizza
      const formPizza = document.getElementById('form-nova-pizza');
      formPizza.addEventListener('submit', function(e) {
        e.preventDefault();
        cadastrarProduto('pizza');
      });

      // Formulário de Bebida
      const formBebida = document.getElementById('form-nova-bebida');
      formBebida.addEventListener('submit', function(e) {
        e.preventDefault();
        cadastrarProduto('bebida');
      });

      // Formulário de Borda
      const formBorda = document.getElementById('form-nova-borda');
      formBorda.addEventListener('submit', function(e) {
        e.preventDefault();
        cadastrarProduto('borda');
      });

      // Botão "Adicionar outro" no modal
      document.getElementById('btn-adicionar-outro').addEventListener('click', function() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('confirmacaoModal'));
        modal.hide();
        limparFormularioAtivo();
      });
    }

    function cadastrarProduto(tipo) {
      const dados = coletarDadosFormulario(tipo);
      
      if (validarDados(dados, tipo)) {
        // Simulação do envio para o servidor
        enviarParaServidor(dados, tipo)
          .then(response => {
            mostrarModalSucesso(tipo);
            if (response.success) {
              // Em produção, você provavelmente recarregaria a lista de produtos
              // ou redirecionaria para a página de gerenciamento
              console.log('Produto cadastrado:', response.produto);
            }
          })
          .catch(error => {
            console.error('Erro ao cadastrar:', error);
            alert('Erro ao cadastrar produto. Tente novamente.');
          });
      }
    }

    function coletarDadosFormulario(tipo) {
      const dados = { tipo };
      
      if (tipo === 'pizza') {
        dados.nome = document.getElementById('pizza-nome').value;
        dados.categoria = document.getElementById('pizza-categoria').value;
        dados.descricao = document.getElementById('pizza-descricao').value;
        dados.preco = parseFloat(document.getElementById('pizza-preco').value);
        dados.imagem = document.getElementById('pizza-imagem').files[0];
      } 
      else if (tipo === 'bebida') {
        dados.nome = document.getElementById('bebida-nome').value;
        dados.tamanho = document.getElementById('bebida-tamanho').value;
        dados.preco = parseFloat(document.getElementById('bebida-preco').value);
        dados.imagem = document.getElementById('bebida-imagem').files[0];
      } 
      else if (tipo === 'borda') {
        dados.nome = document.getElementById('borda-nome').value;
        dados.preco = parseFloat(document.getElementById('borda-preco').value);
        dados.descricao = document.getElementById('borda-descricao').value;
      }
      
      return dados;
    }

    function validarDados(dados, tipo) {
      // Validações básicas
      if (!dados.nome || dados.nome.trim() === '') {
        alert('Por favor, informe o nome do produto');
        return false;
      }
      
      if (isNaN(dados.preco) || dados.preco <= 0) {
        alert('Por favor, informe um preço válido');
        return false;
      }
      
      if (tipo === 'pizza' && !dados.descricao) {
        alert('Por favor, informe a descrição da pizza');
        return false;
      }
      
      return true;
    }

    function enviarParaServidor(dados, tipo) {
      // Simulação de uma chamada AJAX para o servidor
      return new Promise((resolve) => {
        // Em um ambiente real, você usaria fetch() ou axios para enviar os dados
        console.log('Enviando dados para o servidor:', dados);
        
        // Simulando uma resposta do servidor após 1 segundo
        setTimeout(() => {
          // Gerar um ID fictício para o novo produto
          const novoId = Math.floor(Math.random() * 1000) + 100;
          
          // Criar objeto de resposta simulada
          const response = {
            success: true,
            produto: {
              id: novoId,
              ...dados,
              // Remover o arquivo de imagem dos dados retornados
              imagem: tipo === 'pizza' ? 'pizza-placeholder.png' : 
                     tipo === 'bebida' ? 'bebida-placeholder.png' : null
            }
          };
          
          resolve(response);
        }, 1000);
      });
    }

    function mostrarModalSucesso(tipo) {
      const modal = new bootstrap.Modal(document.getElementById('confirmacaoModal'));
      const mensagem = document.getElementById('confirmacaoMensagem');
      
      let texto = '';
      switch(tipo) {
        case 'pizza': texto = 'A pizza foi cadastrada com sucesso!'; break;
        case 'bebida': texto = 'A bebida foi cadastrada com sucesso!'; break;
        case 'borda': texto = 'A borda foi cadastrada com sucesso!'; break;
      }
      
      mensagem.textContent = texto;
      modal.show();
    }

    function limparFormularioAtivo() {
      // Encontra a aba ativa
      const tabAtiva = document.querySelector('#adminTabs .nav-link.active');
      const target = tabAtiva.getAttribute('data-bs-target');
      const form = document.querySelector(`${target} form`);
      
      if (form) {
        form.reset();
      }
    }
  </script>
</body>
</html>