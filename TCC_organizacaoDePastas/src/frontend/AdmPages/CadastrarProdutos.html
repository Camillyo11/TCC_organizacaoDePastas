<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastro de Produtos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="bg-dark text-white">

  <div class="container mt-5">
    <h2 class="text-center mb-4">Cadastro de Produtos</h2>

    <!-- Cadastro de Pizza -->
    <div class="card bg-secondary mb-4">
      <div class="card-body">
        <h5 class="card-title">Nova Pizza</h5>
        <form id="form-nova-pizza" class="row g-3">
          <div class="col-md-6">
            <label for="nomePizza" class="form-label">Nome</label>
            <input type="text" class="form-control" id="nomePizza" name="nome" required />
          </div>
          <div class="col-md-6">
            <label for="precoPizza" class="form-label">Preço</label>
            <input type="number" class="form-control" id="precoPizza" name="preco" step="0.01" required />
          </div>
          <div class="col-md-6">
            <label for="categoriaPizza" class="form-label">Categoria</label>
            <select class="form-select" id="categoriaPizza" name="categoria" required>
              <option value="salgada">Salgada</option>
              <option value="doce">Doce</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="imagemPizza" class="form-label">Imagem</label>
            <input type="file" class="form-control" id="imagemPizza" name="imagem" accept="image/*" required />
          </div>
          <div class="col-12">
            <label for="descricaoPizza" class="form-label">Descrição</label>
            <textarea class="form-control" id="descricaoPizza" name="descricao" rows="3" required></textarea>
          </div>
          <div class="col-12">
            <button type="button" class="btn btn-light" onclick="cadastrarProduto('pizza')">Cadastrar Pizza</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Cadastro de Bebida -->
    <div class="card bg-secondary mb-4">
      <div class="card-body">
        <h5 class="card-title">Nova Bebida</h5>
        <form id="form-nova-bebida" class="row g-3">
          <div class="col-md-6">
            <label for="nomeBebida" class="form-label">Nome</label>
            <input type="text" class="form-control" id="nomeBebida" name="nome" required />
          </div>
          <div class="col-md-6">
            <label for="precoBebida" class="form-label">Preço</label>
            <input type="number" class="form-control" id="precoBebida" name="preco" step="0.01" required />
          </div>
          <div class="col-md-6">
            <label for="tamanhoBebida" class="form-label">Tamanho</label>
            <input type="text" class="form-control" id="tamanhoBebida" name="tamanho" required />
          </div>
          <div class="col-md-6">
            <label for="imagemBebida" class="form-label">Imagem</label>
            <input type="file" class="form-control" id="imagemBebida" name="imagem" accept="image/*" required />
          </div>
          <div class="col-12">
            <button type="button" class="btn btn-light" onclick="cadastrarProduto('bebida')">Cadastrar Bebida</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Sucesso -->
  <div class="modal fade" id="modalSucesso" tabindex="-1" aria-labelledby="modalSucessoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-success text-white">
        <div class="modal-header">
          <h5 class="modal-title" id="modalSucessoLabel">Cadastro realizado com sucesso!</h5>
        </div>
        <div class="modal-body" id="mensagemSucesso">
          Produto cadastrado com sucesso!
        </div>
      </div>
    </div>
  </div>

  <script>
    // Objeto para armazenar os produtos localmente
    const produtosLocais = {
      pizzas: JSON.parse(localStorage.getItem('pizzas')) || [],
      bebidas: JSON.parse(localStorage.getItem('bebidas')) || []
    };

    function coletarDadosFormulario(tipo) {
      if (tipo === 'pizza') {
        return {
          nome: document.getElementById('nomePizza').value,
          preco: parseFloat(document.getElementById('precoPizza').value),
          categoria: document.getElementById('categoriaPizza').value,
          imagem: document.getElementById('imagemPizza').files[0],
          descricao: document.getElementById('descricaoPizza').value
        };
      }
      if (tipo === 'bebida') {
        return {
          nome: document.getElementById('nomeBebida').value,
          preco: parseFloat(document.getElementById('precoBebida').value),
          tamanho: document.getElementById('tamanhoBebida').value,
          imagem: document.getElementById('imagemBebida').files[0]
        };
      }
    }

    function validarDados(dados, tipo) {
      for (let chave in dados) {
        if (!dados[chave] && chave !== 'descricao') {
          alert('Preencha todos os campos obrigatórios!');
          return false;
        }
      }
      return true;
    }

    function mostrarModalSucesso(tipo) {
      const modal = new bootstrap.Modal(document.getElementById('modalSucesso'));
      const mensagem = document.getElementById('mensagemSucesso');
      mensagem.textContent = `O ${tipo} foi cadastrado com sucesso!`;
      modal.show();
    }

    function limparFormulario(tipo) {
      if (tipo === 'pizza') {
        document.getElementById('form-nova-pizza').reset();
      } else if (tipo === 'bebida') {
        document.getElementById('form-nova-bebida').reset();
      }
    }

    function converterImagemParaBase64(imagem, callback) {
      const reader = new FileReader();
      reader.onload = function(e) {
        callback(e.target.result);
      };
      reader.readAsDataURL(imagem);
    }

    function gerarIdUnico() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    async function cadastrarProduto(tipo) {
      const dados = coletarDadosFormulario(tipo);

      if (!validarDados(dados, tipo)) return;

      // Converter imagem para Base64
      if (dados.imagem) {
        converterImagemParaBase64(dados.imagem, function(imagemBase64) {
          const novoProduto = {
            id: gerarIdUnico(),
            nome: dados.nome,
            preco: dados.preco,
            imagem: imagemBase64
          };

          // Adicionar campos específicos
          if (tipo === 'pizza') {
            novoProduto.categoria = dados.categoria;
            novoProduto.descricao = dados.descricao;
            produtosLocais.pizzas.push(novoProduto);
            localStorage.setItem('pizzas', JSON.stringify(produtosLocais.pizzas));
          } else if (tipo === 'bebida') {
            novoProduto.tamanho = dados.tamanho;
            produtosLocais.bebidas.push(novoProduto);
            localStorage.setItem('bebidas', JSON.stringify(produtosLocais.bebidas));
          }

         
          enviarParaBackend(tipo, {
            ...novoProduto,
            imagem: null
          });

          mostrarModalSucesso(tipo);
          limparFormulario(tipo);
        });
      } else {
     
        alert('Selecione uma imagem para o produto!');
      }
    }

    function enviarParaBackend(tipo, dados) {
      let endpoint, body;

      if (tipo === 'pizza') {
        endpoint = '/api/menu/pizzas';
        body = {
          sabor: dados.nome,
          preco_sabor: dados.preco,
          tipo_borda: 'Tradicional', 
          preco_borda: 0, 
          tamanho: 'Média', 
          observacao: dados.descricao
        };
      } else if (tipo === 'bebida') {
        endpoint = '/api/menu/bebidas';
        body = {
          nome: dados.nome,
          tamanho: dados.tamanho,
          preco: dados.preco
        };
      }

      fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('token') // Assumindo que você tem autenticação
        },
        body: JSON.stringify(body)
      })
      .then(response => response.json())
      .then(data => console.log('Sucesso no backend:', data))
      .catch(error => console.error('Erro no backend:', error));
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>